<IfModule mod_rewrite.c>
  RewriteEngine On
  RewriteBase /
  RewriteCond %{REQUEST_FILENAME} !-f
  RewriteCond %{REQUEST_FILENAME} !-d
  RewriteRule ^ index.html [L]
</IfModule>

<IfModule mod_headers.c>
  # Security headers
  Header set X-Content-Type-Options "nosniff"
  Header set X-Frame-Options "SAMEORIGIN"
  Header set Referrer-Policy "strict-origin-when-cross-origin"

  # Never CDN-cache index.html — must be fresh after every deployment
  <If "%{REQUEST_URI} =~ m#^(/index\.html)?$#">
    Header set Cache-Control "no-store, no-cache, must-revalidate"
  </If>

  # CDN-cache everything else for 7 days
  <If "%{REQUEST_URI} !~ m#^(/index\.html)?$#">
    Header set Cache-Control "public, s-maxage=604800, max-age=0"
  </If>

  # Browser-cache hashed assets (CSS/JS) for 7 days — safe because filenames change on rebuild
  <If "%{REQUEST_URI} =~ m#^/assets/.*$#">
    Header set Cache-Control "public, max-age=604800"
  </If>
</IfModule>
